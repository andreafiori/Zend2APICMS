<?php if (empty($records)): ?>
<div class="alert alert-warning">
    <?php if ($this->messageTitle): ?>
    <h1><?php echo $this->messageTitle ?></h1>
    <?php else: ?>
    <h1>Nessun dato in archivio</h1>
    <?php endif; ?>
    
    <?php if ($this->messageDescription): ?>
    <p><?php echo $this->messageDescription ?></p>
    <?php else: ?>
    <p>Nessun dato da elencare &egrave; stato trovato.</p>
    <?php endif; ?>
</div>
<?php else: ?>

<h3><?php echo $this->tableTitle ?></h3>

<p><?php echo $this->tableDescription ?></p>

<div class="table-responsive">
    <table class="table table-bordered" id="zf2-pagination-table">
    <thead>
        <tr>
            <?php foreach($this->columns as $column): ?>
                <?php if ( is_array($column) ): ?>
                <th style="width: <?php echo $column['width'] ?>"><?php echo $column['label'] ?></th>
                <?php else: ?>
                <th><?php echo $column ?></th>
                <?php endif; ?>
            <?php endforeach; ?>
        </tr>
    </thead>
    <tbody>
        <?php foreach($this->records as $records): ?>
        <tr class="odd gradeX">
            <?php foreach($records as $record): ?>
                <?php if (is_array($record)): ?>
                    <?php if ($record['type']=='updateButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg" title="<?php echo $record['title'] ?>"><i class="fa fa-pencil"></i> </a></td>
                    <?php elseif($record['type']=='alboRettificaButton'): ?>
                    <td><a href="#alboRevisionModal" data-id="<?php echo $record['data-id'] ?>" class="open-deleteModal btn btn-lg" title="Rettifica articolo"><i class="fa fa-edit"></i> </a></td>
                    <?php elseif($record['type']=='alboAnnulledButton'): ?>
                    <td colspan="4" valign="middle" class="text-center"><h4>ARTICOLO ANNULLATO</h4></td>
                    <?php elseif($record['type']=='alboAnnullButton'): ?>
                    <td><a href="#alboAnnullModal" data-id="<?php echo $record['data-id'] ?>" class="open-deleteModal btn btn-lg icon-red" title="Annulla articolo"><i class="fa fa-power-off"></i> </a></td>
                    <?php elseif($record['type']=='activeButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg icon-green" title="<?php echo (isset($record['title'])) ? $record['title'] : 'Attiva' ?>"><i class="fa fa-toggle-on"></i> </a></td>
                    <?php elseif($record['type']=='disableButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg icon-red" title="<?php echo (isset($record['title'])) ? $record['title'] : 'Disattiva' ?>"><i class="fa fa-toggle-on"></i> </a></td>
                    <?php elseif($record['type']=='ignore'): ?>
                    <!-- No content -->
                    <?php elseif($record['type']=='noButton'): ?>
                    <td>&nbsp;</td>
                    <?php elseif($record['type']=='deleteButton'): ?>
                    <td><a href="#deleteModal" data-id="<?php echo $record['data-id'] ?>" class="open-deleteModal btn btn-lg icon-red" title="Elimina"><i class="fa fa-times"></i> </a></td>
                    <?php elseif($record['type']=='attachButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg icon-black" title="Gestione allegati"><i class="fa fa-paperclip"></i> </a></td>
                    <?php elseif($record['type']=='relatapdfButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg icon-red" title="Genera documento relata di pubblicazione"><i class="fa fa-file-pdf-o"></i> </a></td>
                    <?php elseif($record['type']=='enteterzoButton'): ?>
                    <td><a href="<?php echo $record['href'] ?>" class="btn btn-lg icon-black" title="Invia ad ente terzo"><i class="fa fa-envelope-square"></i></a></td>
                    <?php endif; ?>
                <?php else: ?>
                <td><?php echo $record ?></td>
                <?php endif; ?>
            <?php endforeach; ?>
        </tr>
        <?php endforeach; ?>
    </tbody>
    </table>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="ConfirmDeleteModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel"><strong>Conferma eliminazione?</strong></h4>
            </div>
            
            <form action="" method="post">
                <div class="modal-body">
                    <p><strong>Attenzione:</strong> i dati di questo elemento e ad esso collegati verranno cancellati definitivamente e non sar&agrave; possibile recuperarli.</p>
                    <div><strong>ID Record: </strong><span id="recordidtodelete"></span></div>
                    <input type="hidden" name="deleteId" id="deleteId" value="" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
                    <button type="submit" class="btn btn-danger">Conferma</button>
                </div>
            </form>
            
        </div>
    </div>
</div>

<!-- Modale revisione articolo albo -->
<div class="modal fade" id="alboRevisionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="alboRevisionModalLabel"><strong>Conferma revisione?</strong></h4>
            </div>
            
            <form action="" method="post">
                <div class="modal-body">
                    <p><strong>Attenzione:</strong> L'articolo &egrave; gi&agrave; stato pubblicato. Passare alla modalit&agrave; di revisione?</p>
                    <p>Una volta confermata la revisione, l'articolo non sar&grave; visibile sul sito web pubblico per permettere di aggiungere o eliminare allegati e dovr&agrave; essere riattivato in questa sezione</p>

                    <input type="hidden" name="deleteId" id="deleteId" value="" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
                    <a href="#" class="btn btn-primary">Conferma</a>
                </div>
            </form>
            
        </div>
    </div>
</div>

<!-- Modale annullamento articolo albo -->
<div class="modal fade" id="alboAnnullModal" tabindex="-1" role="dialog" aria-labelledby="DisableArticleAlboPretorio" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="alboAnnullModalLabel"><strong>Annulla articolo?</strong></h4>
            </div>
            
            <form action="" method="post">
                <div class="modal-body">
                    <p><strong>Attenzione:</strong> una volta annullato l'articolo non potr&agrave; pi&ugrave; essere ripristinato.</p>

                    <input type="hidden" name="alboAnnullModalId" id="alboAnnullModalId" value="" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
                    <a href="#" class="btn btn-danger">Conferma</a>
                </div>
            </form>
            
        </div>
    </div>
</div>

<?php

    if ( count($this->paginator) > 1 ):
        try {
            echo $this->paginationControl(
                $this->paginator,
                'sliding',
                'application/pagination/bootstrap.phtml',
                array(
                    'route' => $this->route,
                    'tablesetter' => $this->tablesetter,
                    'lang'        => $this->lang ? $this->lang : 'it',
                )
            );
        } catch (Exception $e) {
            ?>
            <div class="alert alert-danger">
                <h3>Errore paginazione</h3>
                <p>Errore nella visualizzazione dei numeri di pagina: <?php echo $e->getMessage() ?></p>
            </div>
            <?php
        }
    endif;

endif; 

?>
<script>
// force scroll for large tables
function forceResponsiveTables() {
    var windowSize = $(window).width();
    if ($('.table-responsive > .table').length > 0) {
        $.each($('.table-responsive > .table'), function (index, value) {
            var thisTable = $(value);
            var tableSize = thisTable.width();
            var parent = thisTable.parent('.table-responsive');
            /* 768px is the default for bootstrap 3's responsive-table, modify if needed */
            if (windowSize <= 768) {
                parent.css('width', '').css('overflow-x', '').css('overflow-y', '').css('margin-bottom', '').css('border', '');
            } else {
                if (tableSize >= windowSize) {
                    // Change the border color based on the bootstrap theme colors
                    parent.css('width', '100%').css('overflow-x', 'scroll').css('overflow-y', 'hidden').css('margin-bottom', '15px').css('border', '1px solid #DDDDDD');
                } else {
                    parent.css('width', '').css('overflow-x', '').css('overflow-y', '').css('margin-bottom', '').css('border', '');
                }
            }
        });
    }
}

$(document).ready(function () {
    $(window).resize(forceResponsiveTables);
    forceResponsiveTables();
    
    $( ".open-deleteModal" ).click(function(e) {
        e.preventDefault();

        var _self = $(this);

        var deleteId = _self.data('id');
        $("#deleteId").val(deleteId);
        $("#recordidtodelete").html(deleteId);

        $(_self.attr('href')).modal('show');
    });
});
</script>
